# EKP-Casdoor 同步工具 - 快速启动指南

## 🚀 三种启动方式

### 方法 1：双击批处理文件（推荐，无需管理员权限）

```
双击：启动配置界面.bat
```

**优点：**
- ✅ 最简单，双击即可
- ✅ 不受 PowerShell 执行策略限制
- ✅ 自动检测和编译
- ✅ 中文界面提示

---

### 方法 2：使用 PowerShell（需要执行策略权限）

**如果遇到"禁止运行脚本"错误，先执行：**

```powershell
# 仅对当前会话生效（推荐）
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process

# 然后运行
.\start-ui.ps1
```

**或者直接绕过执行策略：**

```powershell
powershell -ExecutionPolicy Bypass -File .\start-ui.ps1
```

---

### 方法 3：直接运行编译后的程序

```powershell
# 先编译（仅首次或代码更改后需要）
cd SyncEkpToCasdoor.UI
dotnet build -c Release

# 运行
.\bin\Release\net8.0-windows\SyncEkpToCasdoor.UI.exe
```

---

## 🛠️ 解决 PowerShell 执行策略问题

### 临时解决（推荐）

在当前 PowerShell 窗口中执行：

```powershell
Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
```

这只影响当前窗口，关闭后恢复原策略。

### 永久解决（需要管理员权限）

以管理员身份打开 PowerShell，执行：

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

这允许运行本地脚本，但需要远程脚本有签名。

### 查看当前策略

```powershell
Get-ExecutionPolicy -List
```

---

## ✅ 程序已成功启动！

如果你看到了 WPF 窗口，说明启动成功！

**下一步操作：**

1. **配置 EKP 数据库**
   - 服务器地址：`172.16.10.110`
   - 端口：`1433`
   - 数据库：`ekp`
   - 填写用户名和密码
   - 点击"测试 EKP 连接"

2. **配置 Casdoor API**
   - 接口地址：`http://sso.fzcsps.com`
   - 填写 Client ID 和 Secret
   - Owner：`fzswjtOrganization`
   - 点击"测试 Casdoor API"

3. **保存配置**
   - 点击右下角"保存配置"按钮
   - 配置会加密保存到本地

4. **查看日志**
   - 切换到"日志"标签页
   - 查看所有操作记录

---

## 🐛 常见问题

### Q1: 程序启动后闪退？

**原因：** 可能缺少 .NET 8 运行时

**解决：**
```powershell
# 检查 .NET 版本
dotnet --version

# 如果没有 8.x，下载安装：
# https://dotnet.microsoft.com/download/dotnet/8.0
```

### Q2: 界面显示不正常？

**原因：** Material Design 主题加载失败

**解决：**
```powershell
# 重新还原 NuGet 包
cd SyncEkpToCasdoor.UI
dotnet restore
dotnet build -c Release
```

### Q3: 测试连接失败？

**检查清单：**
- [ ] 网络连接正常
- [ ] 服务器地址和端口正确
- [ ] 用户名密码正确
- [ ] 防火墙允许连接
- [ ] SQL Server 开启远程连接

### Q4: 配置保存后再次打开为空？

**原因：** DPAPI 加密绑定到用户和机器

**解决：**
- 不要复制配置文件到其他机器
- 换机器需要重新输入密码
- 确保使用相同的 Windows 用户登录

---

## 📖 详细文档

- **WPF 界面使用指南**: `SyncEkpToCasdoor.UI/README_WPF_UI.md`
- **开发总结**: `WPF_UI_SUMMARY.md`
- **交付报告**: `WPF_DELIVERY_REPORT.md`
- **命令行使用指南**: `USAGE_GUIDE.md`

---

## 🎉 享受使用！

如果一切顺利，你现在应该看到了一个漂亮的 Material Design 风格的配置界面。

祝使用愉快！🚀
