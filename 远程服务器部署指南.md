# ğŸš€ è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## æœåŠ¡å™¨ä¿¡æ¯
- **IPåœ°å€**: 172.16.10.110
- **ç”¨æˆ·å**: root
- **å¯†ç **: fzwater@163.com

---

## ğŸ“¦ éƒ¨ç½²æ–‡ä»¶

1. **auto-deploy-server.sh** - Linuxéƒ¨ç½²è„šæœ¬
2. **deploy-server.bat** - Windowsä¸€é”®éƒ¨ç½²æ‰¹å¤„ç†
3. **quick-deploy-server.ps1** - PowerShelléƒ¨ç½²è„šæœ¬

---

## ğŸ¯ éƒ¨ç½²æ–¹å¼

### æ–¹å¼1: Windowsæ‰¹å¤„ç† (æœ€ç®€å•) âš¡

åŒå‡»è¿è¡Œæˆ–å‘½ä»¤è¡Œæ‰§è¡Œ:
```cmd
.\deploy-server.bat
```

è„šæœ¬ä¼šè‡ªåŠ¨:
1. ä¸Šä¼ éƒ¨ç½²è„šæœ¬åˆ°æœåŠ¡å™¨
2. SSHæ‰§è¡Œéƒ¨ç½²
3. æ˜¾ç¤ºç»“æœ

**éœ€è¦è¾“å…¥å¯†ç 2æ¬¡**: `fzwater@163.com`

---

### æ–¹å¼2: PowerShellè„šæœ¬

```powershell
powershell -ExecutionPolicy Bypass -File quick-deploy-server.ps1
```

æŒ‰æç¤ºè¾“å…¥å¯†ç å³å¯ã€‚

---

### æ–¹å¼3: æ‰‹åŠ¨SSHéƒ¨ç½²

#### æ­¥éª¤1: ä¸Šä¼ è„šæœ¬
```bash
scp auto-deploy-server.sh root@172.16.10.110:/tmp/auto-deploy.sh
```

#### æ­¥éª¤2: SSHç™»å½•
```bash
ssh root@172.16.10.110
```

#### æ­¥éª¤3: æ‰§è¡Œéƒ¨ç½²
```bash
chmod +x /tmp/auto-deploy.sh
/tmp/auto-deploy.sh
```

---

## ğŸ”„ éƒ¨ç½²æµç¨‹

è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤:

1. âœ… **æ£€æŸ¥Git** - å¦‚æœªå®‰è£…åˆ™è‡ªåŠ¨å®‰è£…
2. âœ… **æ£€æŸ¥.NET SDK 8.0** - å¦‚æœªå®‰è£…åˆ™è‡ªåŠ¨å®‰è£…
3. âœ… **è·å–ä»£ç ** - ä»GitHubå…‹éš†/æ›´æ–°
4. âœ… **ç¼–è¯‘åº”ç”¨** - Releaseæ¨¡å¼å‘å¸ƒ
5. âœ… **åœæ­¢æ—§æœåŠ¡** - å¦‚æœå­˜åœ¨
6. âœ… **é…ç½®systemdæœåŠ¡** - è‡ªåŠ¨å¯åŠ¨é…ç½®
7. âœ… **å¯åŠ¨æ–°æœåŠ¡** - ç«‹å³å¯åŠ¨åº”ç”¨

---

## ğŸŒ è®¿é—®åº”ç”¨

éƒ¨ç½²å®Œæˆåè®¿é—®:

```
http://172.16.10.110:5233/login
```

**æµ‹è¯•è´¦å·**:
- ç”¨æˆ·å: admin
- å¯†ç : 123
- ç»„ç»‡: built-in

---

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

### æŸ¥çœ‹çŠ¶æ€
```bash
ssh root@172.16.10.110 "systemctl status ekp-casdoor-sync"
```

### é‡å¯æœåŠ¡
```bash
ssh root@172.16.10.110 "systemctl restart ekp-casdoor-sync"
```

### æŸ¥çœ‹æ—¥å¿—
```bash
ssh root@172.16.10.110 "journalctl -u ekp-casdoor-sync -f"
```

### åœæ­¢æœåŠ¡
```bash
ssh root@172.16.10.110 "systemctl stop ekp-casdoor-sync"
```

### å¯åŠ¨æœåŠ¡
```bash
ssh root@172.16.10.110 "systemctl start ekp-casdoor-sync"
```

---

## ğŸ“ é…ç½®æ–‡ä»¶

éƒ¨ç½²åéœ€è¦é…ç½®:

### 1. SSHç™»å½•æœåŠ¡å™¨
```bash
ssh root@172.16.10.110
```

### 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
```bash
nano ~/ekp-casdoor-sync/SyncEkpToCasdoor_webdocker/SyncEkpToCasdoor.Web/appsettings.json
```

### 3. ä¿®æ”¹é…ç½®é¡¹

```json
{
  "EkpConnection": "Server=ä½ çš„æ•°æ®åº“IP,1433;Database=ecology;User Id=sa;Password=å¯†ç ;TrustServerCertificate=true",
  
  "CasdoorAuth": {
    "ClientId": "cb838421e04ecd30f72b",
    "ClientSecret": "e54b3c2d06c864ac9243a03b8002b75167dce01d",
    "Authority": "http://sso.fzcsps.com",
    "AllowedOwner": "built-in"
  },
  
  "CasdoorSdk": {
    "Endpoint": "http://sso.fzcsps.com",
    "OrganizationName": "built-in",
    "ApplicationName": "app-ekp-casdoor-sync",
    "ClientId": "cb838421e04ecd30f72b",
    "ClientSecret": "e54b3c2d06c864ac9243a03b8002b75167dce01d"
  },
  
  "TargetCompanyIds": "16f1c1a4910426f41649fd14862b99a1,18e389224b660b4d67413f8466285581",
  
  "ScheduledSync": {
    "Enabled": false,
    "IntervalSeconds": 3600
  }
}
```

### 4. é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
```bash
systemctl restart ekp-casdoor-sync
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
systemctl status ekp-casdoor-sync
```

åº”è¯¥æ˜¾ç¤º: **active (running)**

### 2. æ£€æŸ¥ç«¯å£ç›‘å¬
```bash
netstat -tulpn | grep 5233
```

åº”è¯¥æ˜¾ç¤º: **LISTEN on 0.0.0.0:5233**

### 3. æµ‹è¯•è®¿é—®
```bash
curl http://localhost:5233/login
```

åº”è¯¥è¿”å›: **HTTP 200 æˆ– 302**

### 4. æµè§ˆå™¨æµ‹è¯•
æ‰“å¼€æµè§ˆå™¨è®¿é—®:
```
http://172.16.10.110:5233/login
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: SSHè¿æ¥å¤±è´¥
```
Connection refused æˆ– Connection timeout
```

**è§£å†³**:
- æ£€æŸ¥æœåŠ¡å™¨IPæ˜¯å¦æ­£ç¡®
- ç¡®è®¤æœåŠ¡å™¨SSHæœåŠ¡è¿è¡Œä¸­
- æ£€æŸ¥é˜²ç«å¢™è§„åˆ™

### é—®é¢˜2: scpä¸Šä¼ å¤±è´¥
```
Permission denied
```

**è§£å†³**:
- ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®
- æ£€æŸ¥SSHå¯†é’¥é…ç½®
- å°è¯•æ‰‹åŠ¨SSHç™»å½•æµ‹è¯•

### é—®é¢˜3: æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
journalctl -u ekp-casdoor-sync -n 50

# å¸¸è§åŸå› :
# - ç«¯å£è¢«å ç”¨
# - é…ç½®æ–‡ä»¶é”™è¯¯
# - .NETè¿è¡Œæ—¶é—®é¢˜
```

### é—®é¢˜4: æ— æ³•è®¿é—®åº”ç”¨
```
Connection refused
```

**æ£€æŸ¥**:
```bash
# 1. æœåŠ¡æ˜¯å¦è¿è¡Œ
systemctl status ekp-casdoor-sync

# 2. ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tulpn | grep 5233

# 3. é˜²ç«å¢™è§„åˆ™
ufw status
ufw allow 5233/tcp

# 4. æŸ¥çœ‹æ—¥å¿—
journalctl -u ekp-casdoor-sync -f
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

ä»£ç æ›´æ–°å,é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬å³å¯:

```cmd
.\deploy-server.bat
```

æˆ–æ‰‹åŠ¨æ›´æ–°:
```bash
ssh root@172.16.10.110
cd ~/ekp-casdoor-sync
git pull origin web-docker
cd SyncEkpToCasdoor_webdocker/SyncEkpToCasdoor.Web
dotnet publish -c Release -o bin/Release/net8.0/publish
systemctl restart ekp-casdoor-sync
```

---

## ğŸ“Š æœåŠ¡å™¨è¦æ±‚

### æœ€ä½é…ç½®
- **CPU**: 2æ ¸
- **å†…å­˜**: 4GB
- **ç£ç›˜**: 20GB
- **ç³»ç»Ÿ**: Ubuntu 20.04/22.04 æˆ– Debian 10/11

### æ¨èé…ç½®
- **CPU**: 4æ ¸+
- **å†…å­˜**: 8GB+
- **ç£ç›˜**: 50GB+
- **ç³»ç»Ÿ**: Ubuntu 22.04 LTS

---

## ğŸ” å®‰å…¨å»ºè®®

1. âœ… **ä¿®æ”¹é»˜è®¤å¯†ç **
2. âœ… **é…ç½®é˜²ç«å¢™**
   ```bash
   ufw allow 22/tcp
   ufw allow 5233/tcp
   ufw enable
   ```
3. âœ… **ä½¿ç”¨SSHå¯†é’¥è®¤è¯**
4. âœ… **å®šæœŸæ›´æ–°ç³»ç»Ÿ**
   ```bash
   apt-get update && apt-get upgrade
   ```
5. âœ… **é…ç½®Nginxåå‘ä»£ç†(æ¨è)**
6. âœ… **å¯ç”¨HTTPS/SSL**

---

## ğŸ“ è·å–å¸®åŠ©

### SSHå·¥å…·ä¸‹è½½
- **PuTTY**: https://www.putty.org/
- **Windows Terminal**: Microsoft Store
- **MobaXterm**: https://mobaxterm.mobatek.net/

### æ–‡æ¡£
- **é¡¹ç›®README**: https://github.com/myzhangjing/ekp-casdoor-sync
- **æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—**: æœ¬æ–‡æ¡£

---

## âœ… éƒ¨ç½²æ¸…å•

éƒ¨ç½²å‰:
- [ ] æœåŠ¡å™¨å·²å‡†å¤‡å¥½(172.16.10.110)
- [ ] SSHå¯ä»¥è¿æ¥
- [ ] æœ‰rootæƒé™
- [ ] æœ¬åœ°æœ‰SSHå·¥å…·(Windowsè‡ªå¸¦æˆ–PuTTY)

éƒ¨ç½²ä¸­:
- [ ] ä¸Šä¼ è„šæœ¬æˆåŠŸ
- [ ] è„šæœ¬æ‰§è¡Œå®Œæˆ
- [ ] æ— é”™è¯¯æç¤º

éƒ¨ç½²å:
- [ ] æœåŠ¡çŠ¶æ€active (running)
- [ ] å¯ä»¥è®¿é—®ç™»å½•é¡µé¢
- [ ] é…ç½®æ–‡ä»¶å·²ä¿®æ”¹
- [ ] OAuthç™»å½•æµ‹è¯•é€šè¿‡

---

**ğŸ‰ éƒ¨ç½²å®Œæˆåè®¿é—®**: http://172.16.10.110:5233/login
