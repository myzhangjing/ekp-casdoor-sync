# ==========================================
# 手动更新部署命令
# Manual Deployment Commands
# ==========================================

服务器: 172.16.10.110
用户: root
密码: fzwater@163.com
端口: 9000

## 步骤1: 上传最新代码到服务器

```bash
# 方式1: 使用Git直接在服务器上更新(推荐)
ssh root@172.16.10.110
cd ~/ekp-casdoor-sync
git pull origin web-docker

# 方式2: 从本地打包上传
# (如果需要的话)
```

## 步骤2: 编译发布

```bash
cd ~/ekp-casdoor-sync/SyncEkpToCasdoor_webdocker/SyncEkpToCasdoor.Web
dotnet publish -c Release -o bin/Release/net8.0/publish
```

## 步骤3: 停止服务

```bash
# 如果使用systemd
systemctl stop ekp-casdoor-sync

# 或者找到进程并杀掉
ps aux | grep SyncEkpToCasdoor
kill -9 <进程ID>

# 或者使用端口找进程
lsof -ti:9000 | xargs kill -9
```

## 步骤4: 启动服务

```bash
# 方式1: 使用systemd(如果配置了)
systemctl start ekp-casdoor-sync

# 方式2: 直接运行
cd ~/ekp-casdoor-sync/SyncEkpToCasdoor_webdocker/SyncEkpToCasdoor.Web/bin/Release/net8.0/publish
nohup dotnet SyncEkpToCasdoor.Web.dll --urls "http://0.0.0.0:9000" > /dev/null 2>&1 &

# 方式3: 使用screen
screen -S ekp-sync
cd ~/ekp-casdoor-sync/SyncEkpToCasdoor_webdocker/SyncEkpToCasdoor.Web/bin/Release/net8.0/publish
dotnet SyncEkpToCasdoor.Web.dll --urls "http://0.0.0.0:9000"
# 按 Ctrl+A 然后 D 来detach
```

## 步骤5: 验证部署

```bash
# 检查进程
ps aux | grep SyncEkpToCasdoor

# 检查端口
netstat -tulpn | grep 9000

# 测试访问
curl http://localhost:9000/login

# 查看日志
journalctl -u ekp-casdoor-sync -f
# 或
tail -f ~/ekp-casdoor-sync/SyncEkpToCasdoor_webdocker/SyncEkpToCasdoor.Web/logs/*.log
```

## 快速一键更新命令

```bash
ssh root@172.16.10.110 << 'ENDSSH'
cd ~/ekp-casdoor-sync
git pull origin web-docker
cd SyncEkpToCasdoor_webdocker/SyncEkpToCasdoor.Web
dotnet publish -c Release -o bin/Release/net8.0/publish
systemctl restart ekp-casdoor-sync
ENDSSH
```

## 访问地址

http://172.16.10.110:9000/login

## 查看状态

```bash
ssh root@172.16.10.110 "systemctl status ekp-casdoor-sync"
```

## 查看日志

```bash
ssh root@172.16.10.110 "journalctl -u ekp-casdoor-sync -f"
```
