# ğŸš€ SyncEkpToCasdoor.Web éƒ¨ç½²è¯´æ˜

## ğŸ“¦ éƒ¨ç½²åŒ…å·²åˆ›å»º
- æ–‡ä»¶: `deploy_20251031_165043.zip`
- ä½ç½®: `C:\Users\ThinkPad\Desktop\VSCOD\SyncEkpToCasdoor_webdocker\SyncEkpToCasdoor.Web\`

## ğŸ” æœåŠ¡å™¨ä¿¡æ¯
- IP: 172.16.10.110
- ç”¨æˆ·: root
- å¯†ç : fwater@163.com
- éƒ¨ç½²è·¯å¾„: /opt/syncekp-web
- ç«¯å£: 9000

## âš¡ å¿«é€Ÿéƒ¨ç½²ï¼ˆ3æ­¥å®Œæˆï¼‰

### æ­¥éª¤1: ä¸Šä¼ æ–‡ä»¶
åœ¨å½“å‰ PowerShell çª—å£ä¸­ï¼ŒSCP å‘½ä»¤æ­£åœ¨ç­‰å¾…ä½ è¾“å…¥å¯†ç ã€‚

**è¯·åœ¨ç»ˆç«¯ä¸­è¾“å…¥**: `fwater@163.com` ç„¶åæŒ‰å›è½¦

ï¼ˆå¯†ç è¾“å…¥æ—¶ä¸ä¼šæ˜¾ç¤ºï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰

### æ­¥éª¤2: è¿æ¥æœåŠ¡å™¨å¹¶éƒ¨ç½²
æ–‡ä»¶ä¸Šä¼ æˆåŠŸåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```powershell
ssh -o StrictHostKeyChecking=no root@172.16.10.110
```

å†æ¬¡è¾“å…¥å¯†ç : `fwater@163.com`

### æ­¥éª¤3: åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²
è¿æ¥æˆåŠŸåï¼Œå¤åˆ¶ç²˜è´´ä»¥ä¸‹æ‰€æœ‰å‘½ä»¤ï¼ˆä¸€æ¬¡æ€§æ‰§è¡Œï¼‰ï¼š

```bash
cd /opt
mkdir -p syncekp-web
cd syncekp-web

echo "==> è§£å‹æ–‡ä»¶..."
unzip -o /tmp/deploy_20251031_165043.zip
rm /tmp/deploy_20251031_165043.zip

echo "==> åœæ­¢æ—§å®¹å™¨..."
docker stop syncekp-casdoor-web 2>/dev/null || true
docker rm syncekp-casdoor-web 2>/dev/null || true

echo "==> æ„å»º Docker é•œåƒ..."
docker-compose build

echo "==> å¯åŠ¨æ–°å®¹å™¨..."
docker-compose up -d

echo "==> ç­‰å¾…å¯åŠ¨..."
sleep 5

echo "==> æ£€æŸ¥å®¹å™¨çŠ¶æ€..."
docker ps | grep syncekp

echo "==> æŸ¥çœ‹æ—¥å¿—ï¼ˆæœ€å20è¡Œï¼‰..."
docker logs --tail 20 syncekp-casdoor-web

echo ""
echo "========================================"
echo "éƒ¨ç½²å®Œæˆï¼"
echo "========================================"
echo "å†…ç½‘è®¿é—®: http://172.16.10.110:9000"
echo "å¤–ç½‘è®¿é—®: http://syn-ekp.fzcsps.com:9000"
echo ""
echo "æŸ¥çœ‹å®æ—¶æ—¥å¿—: docker logs -f syncekp-casdoor-web"
echo "========================================"
```

## âœ… éªŒè¯éƒ¨ç½²

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
- http://172.16.10.110:9000
- http://syn-ekp.fzcsps.com:9000

åº”è¯¥çœ‹åˆ°ç™»å½•é¡µé¢ã€‚

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep syncekp

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker logs -f syncekp-casdoor-web

# é‡å¯å®¹å™¨
docker restart syncekp-casdoor-web

# åœæ­¢å®¹å™¨
docker stop syncekp-casdoor-web

# å¯åŠ¨å®¹å™¨
docker start syncekp-casdoor-web

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect syncekp-casdoor-web

# è¿›å…¥å®¹å™¨
docker exec -it syncekp-casdoor-web /bin/bash
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç«¯å£å·²è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tulpn | grep 9000
# æˆ–
lsof -i:9000

# åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
kill -9 <PID>
```

### é—®é¢˜2: å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker logs syncekp-casdoor-web

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a | grep syncekp

# åˆ é™¤å®¹å™¨é‡æ–°å¯åŠ¨
docker rm -f syncekp-casdoor-web
docker-compose up -d
```

### é—®é¢˜3: é•œåƒæ„å»ºå¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜é‡æ–°æ„å»º
docker-compose build --no-cache

# æŸ¥çœ‹ Docker ç£ç›˜ç©ºé—´
df -h
docker system df

# æ¸…ç†æ— ç”¨çš„é•œåƒå’Œå®¹å™¨
docker system prune -a
```

### é—®é¢˜4: æ— æ³•è®¿é—®9000ç«¯å£
```bash
# CentOS/RHEL å¼€æ”¾ç«¯å£
firewall-cmd --permanent --add-port=9000/tcp
firewall-cmd --reload

# Ubuntu/Debian å¼€æ”¾ç«¯å£
ufw allow 9000/tcp
ufw reload

# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
firewall-cmd --list-ports  # CentOS
ufw status                  # Ubuntu
```

### é—®é¢˜5: Docker æœåŠ¡æœªå¯åŠ¨
```bash
# å¯åŠ¨ Docker
systemctl start docker
systemctl enable docker

# æ£€æŸ¥ Docker çŠ¶æ€
systemctl status docker
```

## ğŸ“Š Docker Compose é…ç½®

`docker-compose.yml` å†…å®¹ï¼š
- **å®¹å™¨å**: syncekp-casdoor-web
- **ç«¯å£æ˜ å°„**: 9000:9000
- **ç¯å¢ƒ**: Production
- **é‡å¯ç­–ç•¥**: unless-stopped
- **æ—¥å¿—ç›®å½•**: ./logs (æŒ‚è½½åˆ°å®¹å™¨)
- **çŠ¶æ€æ–‡ä»¶**: ./sync_state.json (æŒ‚è½½åˆ°å®¹å™¨)

## ğŸ”„ æ›´æ–°éƒ¨ç½²

åç»­æ›´æ–°æ—¶ï¼Œé‡å¤ä»¥ä¸‹æ­¥éª¤ï¼š
1. åœ¨æœ¬åœ°åˆ›å»ºæ–°çš„éƒ¨ç½²åŒ…
2. ä¸Šä¼ åˆ°æœåŠ¡å™¨ /tmp/
3. è§£å‹å¹¶é‡å¯å®¹å™¨

æˆ–è€…ä½¿ç”¨å¿«é€Ÿæ›´æ–°å‘½ä»¤ï¼š
```bash
cd /opt/syncekp-web
docker-compose down
unzip -o /tmp/deploy_æ–°æ—¶é—´æˆ³.zip
docker-compose build
docker-compose up -d
```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. **å®¹å™¨æ—¥å¿—**: `docker logs syncekp-casdoor-web`
2. **å®¹å™¨çŠ¶æ€**: `docker ps -a`
3. **ç«¯å£å ç”¨**: `netstat -tulpn | grep 9000`
4. **é˜²ç«å¢™**: `firewall-cmd --list-ports`
5. **ç£ç›˜ç©ºé—´**: `df -h`

---

**æç¤º**: 
- å¯†ç è¾“å…¥æ—¶ä¸ä¼šæ˜¾ç¤ºä»»ä½•å­—ç¬¦ï¼Œè¿™æ˜¯æ­£å¸¸çš„å®‰å…¨è¡Œä¸º
- å¦‚æœSSHè¿æ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨IPå’Œç½‘ç»œè¿æ¥
- é¦–æ¬¡éƒ¨ç½²é¢„è®¡éœ€è¦5-10åˆ†é’Ÿï¼ˆä¸‹è½½ .NET 9 é•œåƒï¼‰
