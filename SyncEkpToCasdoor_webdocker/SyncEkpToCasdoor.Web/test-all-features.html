<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨åŠŸèƒ½éªŒè¯æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        .result-box {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .result-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .result-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .result-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .result-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-card">
            <h1 class="mb-4">
                <i class="bi bi-check-circle-fill text-success"></i>
                ç³»ç»Ÿå…¨åŠŸèƒ½éªŒè¯æµ‹è¯•
            </h1>
            
            <div class="alert alert-info">
                <strong>æµ‹è¯•ç¯å¢ƒ:</strong> http://syncas.fzcsps.com<br>
                <strong>æµ‹è¯•è´¦å·:</strong> admin / sosy3080@sohu.com
            </div>

            <div class="row mb-3">
                <div class="col-md-4">
                    <button class="btn btn-primary w-100" onclick="testAdminLogin()">
                        <i class="bi bi-shield-lock"></i> æµ‹è¯•ç‰¹æƒç™»å½•
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-success w-100" onclick="testNavIcons()">
                        <i class="bi bi-list"></i> æ£€æŸ¥å¯¼èˆªå›¾æ ‡
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-warning w-100" onclick="testConfigSave()">
                        <i class="bi bi-save"></i> æµ‹è¯•é…ç½®ä¿å­˜
                    </button>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-12">
                    <button class="btn btn-info w-100" onclick="runAllTests()">
                        <i class="bi bi-play-circle"></i> è¿è¡Œæ‰€æœ‰æµ‹è¯•
                    </button>
                </div>
            </div>

            <div id="results"></div>
        </div>
    </div>

    <script>
        const baseUrl = 'http://syncas.fzcsps.com';
        const resultsDiv = document.getElementById('results');

        function addResult(title, message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result-box result-${type}`;
            div.innerHTML = `
                <strong><i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'}"></i> ${title}</strong><br>
                ${message}
            `;
            resultsDiv.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        async function testAdminLogin() {
            clearResults();
            addResult('æµ‹è¯•1: ç‰¹æƒç™»å½•', 'å¼€å§‹æµ‹è¯•...', 'info');

            try {
                const response = await fetch(`${baseUrl}/api/admin-login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'sosy3080@sohu.com'
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    addResult('âœ… ç‰¹æƒç™»å½•æˆåŠŸ', 
                        `çŠ¶æ€ç : ${response.status}<br>` +
                        `æ¶ˆæ¯: ${data.message}<br>` +
                        `Cookieå·²è®¾ç½®`, 
                        'success');

                    // æµ‹è¯•è®¿é—®ä¸»é¡µ
                    await new Promise(resolve => setTimeout(resolve, 500));
                    const homeResponse = await fetch(`${baseUrl}/`, { credentials: 'include' });
                    const homeHtml = await homeResponse.text();
                    
                    if (homeHtml.includes('ç‰¹æƒé…ç½®')) {
                        addResult('âœ… ç‰¹æƒèœå•æ˜¾ç¤ºæ­£å¸¸', 'ç™»å½•åå¯ä»¥çœ‹åˆ°ç‰¹æƒé…ç½®èœå•', 'success');
                    } else {
                        addResult('âš ï¸ ç‰¹æƒèœå•æœªæ˜¾ç¤º', 'å¯èƒ½éœ€è¦åˆ·æ–°é¡µé¢', 'warning');
                    }
                } else {
                    addResult('âŒ ç™»å½•å¤±è´¥', `${data.message}`, 'error');
                }
            } catch (error) {
                addResult('âŒ æµ‹è¯•é”™è¯¯', error.message, 'error');
            }
        }

        async function testNavIcons() {
            clearResults();
            addResult('æµ‹è¯•2: å¯¼èˆªå›¾æ ‡', 'æ£€æŸ¥å›¾æ ‡æ˜¾ç¤º...', 'info');

            try {
                // å…ˆç™»å½•
                await fetch(`${baseUrl}/api/admin-login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'sosy3080@sohu.com'
                    })
                });

                await new Promise(resolve => setTimeout(resolve, 500));

                const response = await fetch(`${baseUrl}/`, { credentials: 'include' });
                const html = await response.text();

                // æ£€æŸ¥å›¾æ ‡ç±»
                const hasCorrectIcons = 
                    html.includes('bi-house-door-fill') &&
                    html.includes('bi-arrow-repeat') &&
                    html.includes('bi-building') &&
                    html.includes('bi-shield-lock-fill');

                const hasOldIcon = html.includes('bi-house-door-fill-nav-menu');

                if (hasCorrectIcons && !hasOldIcon) {
                    addResult('âœ… å¯¼èˆªå›¾æ ‡æ­£å¸¸', 
                        'æ‰€æœ‰å›¾æ ‡ç±»åæ­£ç¡®:<br>' +
                        'â€¢ Home: bi-house-door-fill âœ“<br>' +
                        'â€¢ åŒæ­¥ç®¡ç†: bi-arrow-repeat âœ“<br>' +
                        'â€¢ å…¬å¸åŒæ­¥: bi-building âœ“<br>' +
                        'â€¢ ç‰¹æƒé…ç½®: bi-shield-lock-fill âœ“', 
                        'success');
                } else if (hasOldIcon) {
                    addResult('âš ï¸ å‘ç°æ—§å›¾æ ‡ç±»', 
                        'ä»ç„¶ä½¿ç”¨ bi-house-door-fill-nav-menu (é”™è¯¯çš„ç±»å)', 
                        'warning');
                } else {
                    addResult('âŒ å›¾æ ‡æ£€æŸ¥å¤±è´¥', 'éƒ¨åˆ†å›¾æ ‡ç±»åç¼ºå¤±', 'error');
                }
            } catch (error) {
                addResult('âŒ æµ‹è¯•é”™è¯¯', error.message, 'error');
            }
        }

        async function testConfigSave() {
            clearResults();
            addResult('æµ‹è¯•3: é…ç½®ä¿å­˜åŠŸèƒ½', 'å¼€å§‹æµ‹è¯•...', 'info');

            try {
                // ç™»å½•
                addResult('æ­¥éª¤1: ç™»å½•', 'æ­£åœ¨ç™»å½•...', 'info');
                await fetch(`${baseUrl}/api/admin-login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'sosy3080@sohu.com'
                    })
                });

                await new Promise(resolve => setTimeout(resolve, 500));

                // è®¿é—®é…ç½®é¡µé¢
                addResult('æ­¥éª¤2: è®¿é—®é…ç½®é¡µé¢', 'æ£€æŸ¥é¡µé¢åŠŸèƒ½...', 'info');
                const settingsResponse = await fetch(`${baseUrl}/admin/settings`, {
                    credentials: 'include'
                });

                if (!settingsResponse.ok) {
                    addResult('âŒ æ— æ³•è®¿é—®é…ç½®é¡µé¢', `çŠ¶æ€ç : ${settingsResponse.status}`, 'error');
                    return;
                }

                const settingsHtml = await settingsResponse.text();

                // æ£€æŸ¥é¡µé¢å…ƒç´ 
                const hasForm = settingsHtml.includes('åŸŸåä¸åè®®é…ç½®');
                const hasSaveButton = settingsHtml.includes('ä¿å­˜æ‰€æœ‰é…ç½®');
                const hasPasswordField = settingsHtml.includes('ç‰¹æƒç™»å½•å¯†ç ');
                const hasUsersField = settingsHtml.includes('ç”¨æˆ·è®¿é—®æ§åˆ¶');

                if (hasForm && hasSaveButton && hasPasswordField && hasUsersField) {
                    addResult('âœ… é…ç½®é¡µé¢å®Œæ•´', 
                        'æ‰€æœ‰é…ç½®é¡¹éƒ½å­˜åœ¨:<br>' +
                        'â€¢ åŸŸåä¸åè®®é…ç½® âœ“<br>' +
                        'â€¢ ç‰¹æƒç™»å½•å¯†ç  âœ“<br>' +
                        'â€¢ ç”¨æˆ·è®¿é—®æ§åˆ¶ âœ“<br>' +
                        'â€¢ ä¿å­˜æŒ‰é’® âœ“<br><br>' +
                        '<strong>æ³¨æ„:</strong> é…ç½®ä¿å­˜éœ€è¦åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨æµ‹è¯•,å› ä¸ºæ¶‰åŠBlazoräº¤äº’', 
                        'success');
                    
                    addResult('ğŸ“ æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤', 
                        '1. è®¿é—® http://syncas.fzcsps.com/admin-login<br>' +
                        '2. ä½¿ç”¨ admin / sosy3080@sohu.com ç™»å½•<br>' +
                        '3. ç‚¹å‡»å·¦ä¾§"ç‰¹æƒé…ç½®"èœå•<br>' +
                        '4. ä¿®æ”¹åŸŸåæˆ–æ·»åŠ ç”¨æˆ·<br>' +
                        '5. ç‚¹å‡»"ä¿å­˜æ‰€æœ‰é…ç½®"<br>' +
                        '6. åˆ·æ–°é¡µé¢æ£€æŸ¥é…ç½®æ˜¯å¦ä¿å­˜', 
                        'warning');
                } else {
                    addResult('âš ï¸ é…ç½®é¡µé¢ä¸å®Œæ•´', 
                        `è¡¨å•: ${hasForm}, ä¿å­˜æŒ‰é’®: ${hasSaveButton}, å¯†ç å­—æ®µ: ${hasPasswordField}, ç”¨æˆ·å­—æ®µ: ${hasUsersField}`, 
                        'warning');
                }
            } catch (error) {
                addResult('âŒ æµ‹è¯•é”™è¯¯', error.message, 'error');
            }
        }

        async function runAllTests() {
            clearResults();
            addResult('ğŸš€ å¼€å§‹å…¨éƒ¨æµ‹è¯•', 'è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹...', 'info');
            
            await testAdminLogin();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testNavIcons();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testConfigSave();
            
            addResult('âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ', 'è¯·æŸ¥çœ‹ä¸Šæ–¹ç»“æœ', 'success');
        }
    </script>
</body>
</html>
