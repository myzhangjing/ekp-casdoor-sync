# 🎯 完成部署 - 最后步骤

## ✅ 当前状态
- 文件已上传到服务器：`/opt/syncekp-web`
- Docker 构建正在进行中（下载 .NET SDK 173MB）

## 📝 你需要在SSH终端中执行的命令

### 方法1：一键完成（推荐）

在你的SSH终端（`root@172.16.10.110`）中，复制粘贴以下命令：

```bash
cd /opt/syncekp-web && \
docker compose up -d && \
sleep 5 && \
echo "=== 容器状态 ===" && \
docker ps | grep syncekp && \
echo "" && \
echo "=== 应用日志 ===" && \
docker logs --tail 30 syncekp-casdoor-web && \
echo "" && \
echo "========================================" && \
echo "部署完成！访问: http://172.16.10.110:9000" && \
echo "========================================"
```

### 方法2：分步执行

#### 第1步：进入目录
```bash
cd /opt/syncekp-web
```

#### 第2步：启动容器（如果构建未完成，会自动构建）
```bash
docker compose up -d
```

#### 第3步：等待启动
```bash
sleep 5
```

#### 第4步：检查状态
```bash
docker ps | grep syncekp
```

#### 第5步：查看日志
```bash
docker logs --tail 30 syncekp-casdoor-web
```

## 🔍 验证部署

### 检查容器是否运行
```bash
docker ps | grep syncekp
```

应该看到：
```
syncekp-casdoor-web   Up X seconds   0.0.0.0:9000->9000/tcp
```

### 查看实时日志
```bash
docker logs -f syncekp-casdoor-web
```

按 `Ctrl+C` 退出日志查看

### 测试访问
在浏览器中打开：
- http://172.16.10.110:9000
- http://syn-ekp.fzcsps.com:9000

应该看到登录页面！

## ⚠️ 如果遇到问题

### 问题1：构建还在进行中
```bash
# 查看构建进度
docker compose build

# 等待构建完成后再启动
docker compose up -d
```

### 问题2：容器启动失败
```bash
# 查看详细日志
docker logs syncekp-casdoor-web

# 查看所有容器（包括已停止的）
docker ps -a | grep syncekp

# 重新启动
docker restart syncekp-casdoor-web
```

### 问题3：端口被占用
```bash
# 查看端口占用
netstat -tulpn | grep 9000

# 停止占用端口的进程
kill -9 <PID>

# 重新启动容器
docker restart syncekp-casdoor-web
```

### 问题4：需要重新构建
```bash
cd /opt/syncekp-web

# 停止容器
docker stop syncekp-casdoor-web
docker rm syncekp-casdoor-web

# 清理旧镜像
docker rmi syncekp-web-syncekp-web

# 重新构建
docker compose build --no-cache

# 启动
docker compose up -d
```

## 📊 常用管理命令

```bash
# 查看容器状态
docker ps | grep syncekp

# 查看日志（最后50行）
docker logs --tail 50 syncekp-casdoor-web

# 查看实时日志
docker logs -f syncekp-casdoor-web

# 重启容器
docker restart syncekp-casdoor-web

# 停止容器
docker stop syncekp-casdoor-web

# 启动容器
docker start syncekp-casdoor-web

# 查看容器详细信息
docker inspect syncekp-casdoor-web

# 进入容器内部
docker exec -it syncekp-casdoor-web /bin/bash

# 查看容器资源使用
docker stats syncekp-casdoor-web
```

## 🔒 Casdoor 登录测试

1. 访问 http://172.16.10.110:9000
2. 点击"通过 Casdoor 登录"
3. 会跳转到 http://sso.fzcsps.com
4. 使用 built-in 组织的用户登录
5. 登录成功后跳转回应用

## 📱 防火墙配置（如果无法访问）

```bash
# CentOS/RHEL
firewall-cmd --permanent --add-port=9000/tcp
firewall-cmd --reload

# Ubuntu/Debian
ufw allow 9000/tcp
ufw reload

# 检查防火墙状态
firewall-cmd --list-ports  # CentOS
ufw status                 # Ubuntu
```

## 🎉 成功标志

当你看到以下内容时，说明部署成功：

1. `docker ps` 显示容器状态为 `Up`
2. 日志中看到 `Now listening on: http://[::]:9000`
3. 浏览器能访问登录页面
4. 点击登录按钮能跳转到 Casdoor

---

**现在请在你的SSH终端中执行上述命令完成部署！** 🚀
