# 部署完成情况

## ✅ 已完成的步骤

### 1. ✓ 文件准备
- ✓ 创建 Dockerfile
- ✓ 创建 docker-compose.yml  
- ✓ 创建 appsettings.Production.json
- ✓ 创建部署包: deploy_20251031_165043.zip (1.5MB)

### 2. ✓ 文件上传
- ✓ 已成功上传到服务器: /tmp/deploy_20251031_165043.zip
- ✓ 已解压到: /opt/syncekp-web/

### 3. ✓ Docker 准备
- ✓ 停止并删除旧容器
- ⏳ Docker 镜像正在构建中...

## 🔄 当前状态

Docker 正在下载 .NET 9.0 SDK 基础镜像并构建应用程序。

这个过程需要 **5-10 分钟**（首次构建），因为需要：
1. 下载 .NET 9.0 SDK 镜像（约 700MB）
2. 下载 .NET 9.0 运行时镜像（约 200MB）
3. 还原 NuGet 包
4. 编译应用程序

## 📋 接下来需要手动完成

由于 Windows PowerShell SSH 密码认证的限制，请按以下步骤完成部署：

### 方法1: 使用 PowerShell SSH（推荐）

打开一个新的 PowerShell 窗口，执行：

```powershell
ssh root@172.16.10.110
```

输入密码: `fwater@163.com`

连接成功后，复制粘贴以下命令：

```bash
cd /opt/syncekp-web

# 等待构建完成（如果还在构建中）
docker compose build

# 启动容器
docker compose up -d

# 等待启动
sleep 5

# 检查状态
docker ps | grep syncekp

# 查看日志
docker logs --tail 30 syncekp-casdoor-web
```

### 方法2: 使用 PuTTY

1. 打开 PuTTY
2. 输入主机: `172.16.10.110`
3. 点击 Open
4. 输入用户名: `root`
5. 输入密码: `fwater@163.com`
6. 执行上面相同的命令

### 方法3: 等待自动完成

如果之前的 `docker compose build` 命令还在运行，它会自动完成构建。
构建完成后，你只需要执行：

```bash
ssh root@172.16.10.110
cd /opt/syncekp-web
docker compose up -d
docker ps | grep syncekp
```

## ✅ 验证部署

部署完成后，在浏览器中访问：

- **内网测试**: http://172.16.10.110:9000
- **外网访问**: http://syn-ekp.fzcsps.com:9000

你应该能看到登录页面。

## 📊 查看状态

```bash
# 查看容器状态
docker ps | grep syncekp

# 查看实时日志
docker logs -f syncekp-casdoor-web

# 查看最近50行日志
docker logs --tail 50 syncekp-casdoor-web

# 查看容器资源使用
docker stats syncekp-casdoor-web

# 进入容器内部
docker exec -it syncekp-casdoor-web /bin/bash
```

## 🔧 管理命令

```bash
# 停止容器
docker stop syncekp-casdoor-web

# 启动容器
docker start syncekp-casdoor-web

# 重启容器
docker restart syncekp-casdoor-web

# 删除容器
docker rm -f syncekp-casdoor-web

# 重新部署
cd /opt/syncekp-web
docker compose down
docker compose build --no-cache
docker compose up -d
```

## 🐛 故障排查

### 如果容器无法启动

1. 查看日志:
```bash
docker logs syncekp-casdoor-web
```

2. 检查端口占用:
```bash
netstat -tulpn | grep 9000
```

3. 检查 Docker 网络:
```bash
docker network ls
docker network inspect syncekp-web_app-network
```

### 如果无法访问

1. 检查防火墙:
```bash
firewall-cmd --list-ports
firewall-cmd --add-port=9000/tcp --permanent
firewall-cmd --reload
```

2. 检查 SELinux (如果启用):
```bash
getenforce
setenforce 0  # 临时禁用测试
```

3. 测试容器内部访问:
```bash
docker exec syncekp-casdoor-web curl http://localhost:9000/login
```

## 📞 需要帮助？

如果遇到问题，请提供：

1. **容器日志**:
```bash
docker logs syncekp-casdoor-web > /tmp/container.log
cat /tmp/container.log
```

2. **容器状态**:
```bash
docker ps -a | grep syncekp
docker inspect syncekp-casdoor-web
```

3. **端口状态**:
```bash
netstat -tulpn | grep 9000
```

---

## 📝 配置信息

- **服务器IP**: 172.16.10.110
- **部署路径**: /opt/syncekp-web
- **容器名**: syncekp-casdoor-web
- **端口**: 9000
- **域名**: syn-ekp.fzcsps.com:9000
- **OAuth回调**: http://syn-ekp.fzcsps.com:9000/callback
- **Casdoor SSO**: http://sso.fzcsps.com

## 🎉 完成！

一旦容器成功启动，你就可以：

1. 访问 http://syn-ekp.fzcsps.com:9000
2. 点击"通过 Casdoor 登录"
3. 使用 built-in 组织的用户登录
4. 开始使用系统

**所有文件已上传并准备就绪，只需等待 Docker 构建完成并启动容器！**
